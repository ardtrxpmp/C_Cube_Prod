{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Story Mode Progress Schema",
  "description": "Schema for wallet-based story mode progress tracking",
  "type": "object",
  "required": ["walletAddress", "lastUpdated", "chapterProgress", "overallStats"],
  "properties": {
    "walletAddress": {
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{40}$",
      "description": "Ethereum wallet address"
    },
    "lastUpdated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp of last progress update"
    },
    "chapterProgress": {
      "type": "object",
      "description": "Progress for each story chapter",
      "patternProperties": {
        "^chapter-[0-9]{2}$": {
          "type": "object",
          "required": ["chapterStatus", "currentQuestionIndex", "totalQuestions", "completedQuestions", "attemptedQuestions"],
          "properties": {
            "chapterStatus": {
              "type": "string",
              "enum": ["not-started", "in-progress", "completed"],
              "description": "Current status of the chapter"
            },
            "currentQuestionIndex": {
              "type": "integer",
              "minimum": 0,
              "description": "Index of current question (0-based)"
            },
            "totalQuestions": {
              "type": "integer",
              "minimum": 1,
              "description": "Total number of questions in chapter"
            },
            "completedQuestions": {
              "type": "array",
              "items": {
                "type": "integer",
                "minimum": 0
              },
              "description": "Array of completed question indices"
            },
            "attemptedQuestions": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["questionIndex", "questionId", "attempts", "lastAttempt", "isCorrect"],
                "properties": {
                  "questionIndex": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "questionId": {
                    "type": "string"
                  },
                  "attempts": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "lastAttempt": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "isCorrect": {
                    "type": "boolean"
                  },
                  "selectedChoice": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "correctChoice": {
                    "type": "integer",
                    "minimum": 0
                  }
                }
              }
            },
            "score": {
              "type": "integer",
              "minimum": 0,
              "description": "Chapter score (0-100)"
            },
            "timeSpent": {
              "type": "integer",
              "minimum": 0,
              "description": "Time spent in chapter (seconds)"
            }
          }
        }
      }
    },
    "overallStats": {
      "type": "object",
      "required": ["totalChaptersStarted", "totalChaptersCompleted", "totalQuestionsAttempted", "totalQuestionsCorrect", "accuracyRate", "totalScore", "totalTimeSpent", "lastPlaySession"],
      "properties": {
        "totalChaptersStarted": {
          "type": "integer",
          "minimum": 0
        },
        "totalChaptersCompleted": {
          "type": "integer",
          "minimum": 0
        },
        "totalQuestionsAttempted": {
          "type": "integer",
          "minimum": 0
        },
        "totalQuestionsCorrect": {
          "type": "integer",
          "minimum": 0
        },
        "accuracyRate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "totalScore": {
          "type": "integer",
          "minimum": 0
        },
        "totalTimeSpent": {
          "type": "integer",
          "minimum": 0,
          "description": "Total time spent in seconds"
        },
        "lastPlaySession": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  }
}