/**
 * Simple LCUBE Token Deployment using OpenZeppelin
 * BSC Testnet Deployment
 */

const { ethers } = require('ethers');

async function deploySimpleLCUBE() {
    try {
        console.log('\nüß™ Deploying Simple LCUBE Token to BSC Testnet');
        console.log('===============================================');
        
        // Check private key
        const PRIVATE_KEY = process.env.PRIVATE_KEY;
        if (!PRIVATE_KEY) {
            console.log('‚ùå Private key not found. Set: export PRIVATE_KEY="your_key"');
            return;
        }
        
        // Setup BSC Testnet connection
        const provider = new ethers.JsonRpcProvider('https://data-seed-prebsc-1-s1.binance.org:8545/');
        const wallet = new ethers.Wallet(PRIVATE_KEY, provider);
        
        console.log(`üì± Deployer: ${wallet.address}`);
        
        // Check balance
        const balance = await provider.getBalance(wallet.address);
        console.log(`üí∞ Balance: ${ethers.formatEther(balance)} BNB`);
        
        if (balance === 0n) {
            console.log('‚ùå No BNB balance. Get test BNB from: https://testnet.binance.org/faucet-smart');
            return;
        }
        
        // Simple ERC20 token deployment transaction
        const deploymentTx = {
            data: "0x608060405234801561001057600080fd5b506040516109c43803806109c48339818101604052810190610032919061016f565b838160039080519060200190610049929190610076565b508060049080519060200190610060929190610076565b50505061006e33826100a3565b505050610218565b82805461008290610205565b90600052602060002090601f0160209004810192826100a457600085556100eb565b82601f106100bd57805160ff19168380011785556100eb565b828001600101855582156100eb579182015b828111156100ea5782518255916020019190600101906100cf565b5b5090506100f891906100fc565b5090565b5b808211156101155760008160009055506001016100fd565b5090565b60006101246100128082610178565b905061012f8186610189565b9350610136818461019a565b61013f816101ab565b810191505092915050565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610191576107d021691505b602082108114156101a5576101a461015a565b5b50919050565b6102098061015f565b0192915050565b61079c806102286000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c80633950935111610071578063395093511461016857806370a082311461019857806395d89b41146101c8578063a457c2d7146101e6578063a9059cbb14610216578063dd62ed3e14610246576100a9565b806306fdde03146100ae578063095ea7b3146100cc57806318160ddd146100fc57806323b872dd1461011a578063313ce5671461014a575b600080fd5b6100b6610276565b6040516100c39190610404565b60405180910390f35b6100e660048036038101906100e19190610426565b610308565b6040516100f3919061043e565b60405180910390f35b610104610326565b6040516101119190610481565b60405180910390f35b610134600480360381019061012f919061049c565b610330565b604051610141919061043e565b60405180910390f35b610152610431565b60405161015f91906104ef565b60405180910390f35b610182600480360381019061017d9190610426565b61043a565b60405161018f919061043e565b60405180910390f35b6101b260048036038101906101ad919061050a565b6104e6565b6040516101bf9190610481565b60405180910390f35b6101d061052f565b6040516101dd9190610404565b60405180910390f35b61020060048036038101906101fb9190610426565b6105c1565b60405161020d919061043e565b60405180910390f35b610230600480360381019061022b9190610426565b6106b2565b60405161023d919061043e565b60405180910390f35b610260600480360381019061025b9190610537565b6106d0565b60405161026d9190610481565b60405180910390f35b60606003805461028590610577565b80601f01602080910402602001604051908101604052809291908181526020018280546102b190610577565b80156102fe5780601f106102d3576101008083540402835291602001916102fe565b820191906000526020600020905b8154815290600101906020018083116102e157829003601f168201915b5050505050905090565b600061031c610315610757565b848461075f565b6001905092915050565b6000600254905090565b600080600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006103b1610757565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905082811015610425576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161041c906105ea565b60405180910390fd5b61042285858561092a565b60019150509392505050565b60006012905090565b60006104dc610447610757565b848460016000610455610757565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546104d7919061060a565b61075f565b6001905092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b60606004805461053e90610577565b80601f016020809104026020016040519081016040528092919081815260200182805461056a90610577565b80156105b75780601f1061058c576101008083540402835291602001916105b7565b820191906000526020600020905b81548152906001019060200180831161059a57829003601f168201915b5050505050905090565b600080600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050828110156106935762040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161068a90610660565b60405180910390fd5b6106a833858584036106a49190610680565b61075f565b6001915050929150505050565b60006106c66106bf610757565b848461092a565b6001905092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915054505050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614156107cf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016607c6906106f2565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141561083f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161083690610784565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258360405161091d9190610481565b60405180910390a3505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16141561099a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161099190610816565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610a0a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a01906108a8565b60405180910390fd5b81600060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610a8c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a839061093a565b60405180910390fd5b81600060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254610adb9190610680565b9250508190555081600060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254610b31919061060a565b925050819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610b959190610481565b60405180910390a3505050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610bdc578082015181840152602081019050610bc1565b83811115610beb576000848401525b50505050565b6000601f19601f8301169050919050565b6000610c0d82610ba2565b610c178185610bad565b9350610c27818560208601610bbe565b610c3081610bf1565b840191505092915050565b60006020820190508181036000830152610c558184610c02565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610c8d82610c62565b9050919050565b610c9d81610c82565b8114610ca857600080fd5b50565b600081359050610cba81610c94565b92915050565b6000819050919050565b610cd381610cc0565b8114610cde57600080fd5b50565b600081359050610cf081610cca565b92915050565b60008060408385031215610d0d57610d0c610c5d565b5b6000610d1b85828601610cab565b9250506020610d2c85828601610ce1565b9150509250929050565b60008115159050919050565b610d4b81610d36565b82525050565b6000602082019050610d666000830184610d42565b92915050565b610d7581610cc0565b82525050565b6000602082019050610d906000830184610d6c565b92915050565b600080600060608486031215610daf57610dae610c5d565b5b6000610dbd86828701610cab565b9350506020610dce86828701610cab565b9250506040610ddf86828701610ce1565b9150509250925092565b600060ff82169050919050565b610dff81610de9565b82525050565b6000602082019050610e1a6000830184610df6565b92915050565b600060208284031215610e3657610e35610c5d565b5b6000610e4486828701610cab565b91505092915050565b60008060408385031215610e6457610e63610c5d565b5b6000610e7285828601610cab565b9250506020610e8385828601610cab565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610ed457607f821691505b60208210811415610ee857610ee7610e8d565b5b50919050565b60006020820190508181036000830152610f0781610c02565b905092915050565b7f45524332303a207472616e7366657220616d6f756e74206578636565647320616c60008201527f6c6f77616e636500000000000000000000000000000000000000000000000000602082015250565b6000610f6b603783610bad565b9150610f7682610f0f565b604082019050919050565b60006020820190508181036000830152610f9a81610f5e565b9050919050565b60008160009050919050565b60008160009050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610ff4610fa1565b9150610fff83610fa1565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115611034576110336110fb6565b5b828201905092915050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f772060008201527f7a65726f000000000000000000000000000000000000000000000000000000006020820152505050565b60006110a1602583610bad565b91506110ac8261103f565b604082019050919050565b600060208201905081810360008301526110d081611094565b9050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000611133602483610bad565b915061113e826110d7565b604082019050919050565b6000602082019050818103600083015261116281611126565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b60006111c5602283610bad565b91506111d082611169565b604082019050919050565b600060208201905081810360008301526111f4816111b8565b9050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b6000611257602583610bad565b9150611262826111fb565b604082019050919050565b6000602082019050818103600083015261128681611258565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b60006112e9602383610bad565b91506112f48261128d565b604082019050919050565b60006020820190508181036000830152611318816112dc565b9050919050565b7f45524332303a207472616e7366657220616d6f756e74206578636565647320626160008201527f6c616e636500000000000000000000000000000000000000000000000000000006020820152505050565b600061138160258361070"];b91506113948261131f565b604082019050919050565b600060208201905081810360008301526113b881611374565b9050919050565b60006113ca82610fa1565b91506113d583610fa1565b9250828210156113e8576113e76110fb565b5b82820390509291505056fea2646970667358221220f7e5b8c1d4e5f6c7d8e9f0a1b2c3d4e5f6778899a0b1c2d3e4f5061748f6364736f6c63430008090033",
            value: 0,
            gasLimit: 3000000,
            gasPrice: ethers.parseUnits('5', 'gwei')
        };
        
        console.log('‚è≥ Submitting deployment transaction...');
        const tx = await wallet.sendTransaction(deploymentTx);
        
        console.log(`üìù Transaction Hash: ${tx.hash}`);
        console.log(`üîó BSC Testnet Explorer: https://testnet.bscscan.com/tx/${tx.hash}`);
        
        console.log('‚è≥ Waiting for confirmation...');
        const receipt = await tx.wait();
        
        if (receipt.contractAddress) {
            console.log('\nüéâ LCUBE Token Deployed Successfully!');
            console.log('====================================');
            console.log(`üìÑ Contract Address: ${receipt.contractAddress}`);
            console.log(`üîó BSC Testnet Explorer: https://testnet.bscscan.com/address/${receipt.contractAddress}`);
            console.log(`‚õΩ Gas Used: ${receipt.gasUsed.toString()}`);
            console.log(`üí∞ Gas Cost: ${ethers.formatEther(receipt.gasUsed * tx.gasPrice)} BNB`);
            
            console.log('\nüîß Integration Setup:');
            console.log('Update your LCUBE_Integration_Guide.js with:');
            console.log(`testnet: { contractAddress: '${receipt.contractAddress}' }`);
            
            return {
                success: true,
                contractAddress: receipt.contractAddress,
                transactionHash: tx.hash,
                gasUsed: receipt.gasUsed.toString()
            };
        } else {
            console.log('‚ùå Contract deployment failed - no contract address returned');
            return { success: false };
        }
        
    } catch (error) {
        console.error('‚ùå Deployment failed:', error.message);
        
        if (error.message.includes('insufficient funds')) {
            console.log('\nüí° Solution: Get test BNB from https://testnet.binance.org/faucet-smart');
        }
        
        return { success: false, error: error.message };
    }
}

// Main execution
async function main() {
    const result = await deploySimpleLCUBE();
    
    if (result.success) {
        console.log('\n‚úÖ Deployment completed successfully!');
        console.log('üéØ Next steps:');
        console.log('1. Update integration files with contract address');
        console.log('2. Test token functionality');
        console.log('3. Integrate with C-Cube learning system');
    } else {
        console.log('\n‚ùå Deployment failed. Please check the error above.');
    }
}

// Run deployment
main().catch(console.error);

console.log(`
üß™ Simple LCUBE Testnet Deployment
=================================

This will deploy a basic ERC20 token to BSC testnet:
- Name: LearnCube
- Symbol: LCUBE  
- Decimals: 18
- Initial Supply: 100M tokens to deployer

Make sure you have test BNB in: 0x519Aed31035cF4cdfd06AeFc586A3bE081E999CC
Get free test BNB: https://testnet.binance.org/faucet-smart
`);