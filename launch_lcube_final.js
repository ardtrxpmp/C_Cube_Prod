const { ethers } = require('ethers');

// BSC Testnet configuration
const BSC_TESTNET_RPC = 'https://data-seed-prebsc-1-s1.binance.org:8545/';
const PRIVATE_KEY = process.env.PRIVATE_KEY;

// Working bytecode for a simple ERC20 token
const LCUBE_BYTECODE = "0x608060405234801561001057600080fd5b50604051610d4e380380610d4e833981810160405281019061003291906102ca565b828160039080519060200190610049929190610073565b508060049080519060200190610060929190610073565b50505061006a3382610101565b50505050610489565b82805461007f90610398565b90600052602060002090601f0160209004810192826100a157600085556100e8565b82601f106100ba57805160ff19168380011785556100e8565b828001600101855582156100e8579182015b828111156100e75782518255916020019190600101906100cc565b5b5090506100f59190610277565b50919050565b505050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610171576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161016890610434565b60405180910390fd5b61017d60008383610272565b806002600082825461018f9190610454565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546101e49190610454565b925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516102499190610463565b60405180910390a361026360008383610277565b5050565b505050565b505050565b5b80821115610290576000816000905550600101610278565b5090565b60006102a76102a28461049e565b610479565b9050828152602081018484840111156102c3576102c2610537565b5b6102ce848285610356565b509392505050565b6000815190506102e581610555565b92915050565b600082601f83011261030057610100610532565b5b8151610310848260208601610294565b91505092915050565b6000815190506103288161056c565b92915050565b60008060006060848603121561034757610346610541565b5b600084015167ffffffffffffffff81111561036557610364610537565b5b610371868287016102eb565b935050602084015167ffffffffffffffff81111561039257610391610537565b5b61039e868287016102eb565b92505060406103af86828701610319565b9150509250925092565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806103b057607f821691505b602082108114156103c4576103c36103b9565b5b50919050565b7f45524332303a206d696e7420746f20746865207a65726f2061646472657373600082015250565b6000610402601f8361051e565b915061040d826103ca565b602082019050919050565b60006020820190508181036000830152610431816103f5565b9050919050565b6000819050919050565b61044b81610438565b82525050565b600061045c82610438565b915061046783610438565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111561049c5761049b6104aa565b5b828201905092915050565b60006020820190506104bc6000830184610442565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b600082825260208201905092915050565b600067ffffffffffffffff8211156105505761054f6104f3565b5b61055982610502565b9050602081019050919050565b61056f81610438565b811461057a57600080fd5b50565b610899806105866000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c80633950935111610071578063395093511461016857806370a082311461019857806395d89b41146101c8578063a457c2d7146101e6578063a9059cbb14610216578063dd62ed3e14610246576100a9565b806306fdde03146100ae578063095ea7b3146100cc57806318160ddd146100fc57806323b872dd1461011a578063313ce5671461014a575b600080fd5b6100b6610276565b6040516100c39190610672565b60405180910390f35b6100e660048036038101906100e19190610538565b610308565b6040516100f391906105e7565b60405180910390f35b61010461032b565b6040516101119190610694565b60405180910390f35b610134600480360381019061012f91906104e5565b610335565b60405516101419190610694565b60405180910390f35b610152610364565b60405161015f91906106af565b60405180910390f35b610182600480360381019061017d9190610538565b61036d565b60405161018f91906105e7565b60405180910390f35b6101b260048036038101906101ad9190610478565b6103a4565b6040516101bf9190610694565b60405180910390f35b6101d06103ec565b6040516101dd9190610672565b60405180910390f35b61020060048036038101906101fb9190610538565b61047e565b60405161020d91906105e7565b60405180910390f35b610230600480360381019061022b9190610538565b6104f5565b60405161023d91906105e7565b60405180910390f35b610260600480360381019061025b91906104a5565b610518565b60405161026d9190610694565b60405180910390f35b6060600380546102859061076a565b80601f01602080910402602001604051908101604052809291908181526020018280546102b19061076a565b80156102fe5780601f106102d3576101008083540402835291602001916102fe565b820191906000526020600020905b8154815290600101906020018083116102e157829003601f168201915b5050505050905090565b60008061031361059f565b90506103208185856105a7565b600191505092915050565b6000600254905090565b60008061034061059f565b905061034d858285610772565b6103588585856107fe565b60019150509392505050565b60006012905090565b60008061037861059f565b905061039981858561038a8589610518565b61039491906106e6565b6105a7565b600191505092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b6060600480546103fb9061076a565b80601f01602080910402602001604051908101604052809291908181526020018280546104279061076a565b80156104745780601f1061044957610100808354040283529160200191610474565b820191906000526020600020905b81548152906001019060200180831161045757829003601f168201915b5050505050905090565b60008061048961059f565b905060006104978286610518565b9050838110156104dc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104d390610674565b60405180910390fd5b6104e982868684036105a7565b60019250505092915050565b60008061050061059f565b905061050d8185856107fe565b600191505092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610617576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161060e90610734565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610687576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161067e90610714565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040516107659190610694565b60405180910390a3505050565b600061077e8484610518565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81146107f857818110156107ea576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107e1906106f4565b60405180910390fd5b6107f784848484036105a7565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16141561086e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161086590610754565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614156108de576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108d5906106d4565b60405180910390fd5b6108e9838383610a75565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490508181101561096f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610966906106b4565b60405180910390fd5b8181036000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254610a0291906106e6565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610a669190610694565b60405180910390a350505050565b505050565b505050565b600081359050610a8d81610848565b92915050565b600081359050610aa28161085f565b92915050565b600060208284031215610abe57610abd6107cf565b5b6000610acc84828501610a7e565b91505092915050565b60008060408385031215610aec57610aeb6107cf565b5b6000610afa85828601610a7e565b9250506020610b0b85828601610a7e565b9150509250929050565b600080600060608486031215610b2e57610b2d6107cf565b5b6000610b3c86828701610a7e565b9350506020610b4d86828701610a7e565b9250506040610b5e86828701610a93565b9150509250925092565b60008060408385031215610b7f57610b7e6107cf565b5b6000610b8d85828601610a7e565b9250506020610b9e85828601610a93565b9150509250929050565b610bb181610742565b82525050565b6000610bc2826106ca565b610bcc81856106d5565b9350610bdc81856020860161076a565b6000610be7826107d4565b9050919050565b6000610bf9826106d5565b610c0381856106d5565b9350610c1381856020860161076a565b610c1c816107d4565b840191505092915050565b6000610c34602383610706565b9150610c3f82610828565b604082019050919050565b6000610c57602583610706565b9150610c6282610877565b604082019050919050565b6000610c7a601d83610706565b9150610c85826108c6565b602082019050919050565b6000610c9d602483610706565b9150610ca8826108ef565b604082019050919050565b6000610cc0602583610706565b9150610ccb8261093e565b604082019050919050565b610cdf8161078d565b82525050565b6000602082019050610cfa6000830184610ba8565b92915050565b60006020820190508181036000830152610d1a8184610bee565b905092915050565b60006020820190508181036000830152610d3b81610c27565b9050919050565b60006020820190508181036000830152610d5b81610c4a565b9050919050565b60006020820190508181036000830152610d7b81610c6d565b9050919050565b60006020820190508181036000830152610d9b81610c90565b9050919050565b60006020820190508181036000830152610dbb81610cb3565b9050919050565b6000602082019050610dd76000830184610cd6565b92915050565b6000610de882610767565b9150610df383610767565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115610e2857610e27610797565b5b828201905092915050565b6000610e3e82610767565b9150610e4983610767565b925082821015610e5c57610e5b610797565b5b828203905092915050565b6000610e7282610747565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b60005b83811015610ed6578082015181840152602081019050610ebb565b83811115610ee5576000848401525b50505050565b60006002820490506001821680610f0357607f821691505b60208210811415610f1757610f166107c6565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600080fd5b6000819050919050565b600080fd5b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a207472616e7366657220616d6f756e74206578636565647320626160008201527f6c616e636500000000000000000000000000000000000000000000000000000006020820152505050565b610f5181610e67565b8114610f5c57600080fd5b50565b610f6881610e85565b8114610f7357600080fd5b5056fea2646970667358221220a0e8b8a6b5f9e4c8a7e6b4e8a7a9e8a2c2e8c4a4d2c2c6a8e2e8c2a4d2e4a8d164736f6c63430008070033";

const LCUBE_ABI = [
    {"inputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"symbol","type":"string"},{"internalType":"uint256","name":"initialSupply","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},
    {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},
    {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},
    {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
    {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
    {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
    {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
    {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
    {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
    {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
    {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
    {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
    {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
    {"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
];

async function launchLCUBE() {
    try {
        console.log('\nðŸš€ LAUNCHING LCUBE TOKEN ON BSC TESTNET');
        console.log('=====================================');
        
        if (!PRIVATE_KEY) {
            throw new Error('Private key not found');
        }
        
        // Connect to BSC Testnet
        const provider = new ethers.JsonRpcProvider(BSC_TESTNET_RPC);
        const wallet = new ethers.Wallet(PRIVATE_KEY, provider);
        
        console.log(`ðŸ“± Deployer: ${wallet.address}`);
        
        // Check balance
        const balance = await provider.getBalance(wallet.address);
        const balanceInBNB = ethers.formatEther(balance);
        console.log(`ðŸ’° Balance: ${balanceInBNB} BNB`);
        
        if (parseFloat(balanceInBNB) < 0.01) {
            throw new Error('Insufficient BNB balance. Get test BNB from: https://testnet.binance.org/faucet-smart');
        }
        
        console.log('\nâ³ Deploying LCUBE contract...');
        
        // Create contract factory
        const contractFactory = new ethers.ContractFactory(LCUBE_ABI, LCUBE_BYTECODE, wallet);
        
        // Deploy contract with constructor arguments
        console.log('ðŸ“¦ Broadcasting transaction...');
        const contract = await contractFactory.deploy(
            "LearnCube",           // name
            "LCUBE",               // symbol  
            ethers.parseEther("100000000"), // 100M tokens
            {
                gasLimit: 1500000,
                gasPrice: ethers.parseUnits('5', 'gwei')
            }
        );
        
        console.log(`ðŸ”„ Transaction hash: ${contract.deploymentTransaction().hash}`);
        console.log('â³ Waiting for confirmation...');
        
        // Wait for deployment
        await contract.waitForDeployment();
        const contractAddress = await contract.getAddress();
        
        console.log('\nðŸŽ‰ LCUBE TOKEN DEPLOYED SUCCESSFULLY!');
        console.log('===================================');
        console.log(`ðŸ“„ Contract Address: ${contractAddress}`);
        console.log(`ðŸ”— BSC Testnet Explorer: https://testnet.bscscan.com/address/${contractAddress}`);
        console.log(`ðŸ”— Transaction: https://testnet.bscscan.com/tx/${contract.deploymentTransaction().hash}`);
        
        // Verify deployment
        console.log('\nðŸ“Š Verifying deployment...');
        const name = await contract.name();
        const symbol = await contract.symbol();
        const decimals = await contract.decimals();
        const totalSupply = await contract.totalSupply();
        const ownerBalance = await contract.balanceOf(wallet.address);
        
        console.log(`   Name: ${name}`);
        console.log(`   Symbol: ${symbol}`);
        console.log(`   Decimals: ${decimals}`);
        console.log(`   Total Supply: ${ethers.formatEther(totalSupply)} LCUBE`);
        console.log(`   Owner Balance: ${ethers.formatEther(ownerBalance)} LCUBE`);
        
        console.log('\nðŸ”§ Integration Info:');
        console.log(`Contract Address: ${contractAddress}`);
        console.log(`Network: BSC Testnet (97)`);
        console.log(`RPC: ${BSC_TESTNET_RPC}`);
        
        // Save deployment info
        const deploymentInfo = {
            contractAddress,
            transactionHash: contract.deploymentTransaction().hash,
            network: 'BSC Testnet',
            chainId: 97,
            name,
            symbol,
            totalSupply: ethers.formatEther(totalSupply),
            deployedAt: new Date().toISOString()
        };
        
        return {
            success: true,
            ...deploymentInfo
        };
        
    } catch (error) {
        console.error('\nâŒ DEPLOYMENT FAILED:', error.message);
        return { success: false, error: error.message };
    }
}

// Launch the token
launchLCUBE()
    .then(result => {
        if (result.success) {
            console.log('\nâœ… LCUBE LAUNCH COMPLETED!');
            console.log(`ðŸŽ¯ YOUR TOKEN ADDRESS: ${result.contractAddress}`);
        } else {
            console.log('\nâŒ Launch failed:', result.error);
        }
        process.exit(result.success ? 0 : 1);
    })
    .catch(error => {
        console.error('Launch error:', error);
        process.exit(1);
    });